
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as be}from"./index-c786b651.js";import{d as ye,r as f,Q as B,B as Y,t as we,o as n,c as U,e as l,f as t,R as P,S as D,b as u,j as Ae,k as i,w as Ve,I as _,x as v,a as x,J as T,U as ke,V as k,W as Ie,E as I,h as r,X as he,l as Ce,q as E}from"./index-56458f60.js";import{u as Ue}from"./utcformatTime-e76e5157.js";import{E as xe,A as Te,Q as Se}from"./index-70c9cd4a.js";const Pe={style:{maxWidth:"350px"}},De={style:{maxHeight:"50px",cursor:"pointer"}},ze={style:{maxWidth:"350px"}},Ne={style:{maxHeight:"50px",cursor:"pointer"}},qe=["src"],Oe={class:"flex justify-end mr-5"},Re=ye({__name:"application",setup($e){const L=f(),j=f(0),A=f(!1),S=f(!1),p=B({catId:"",name:"",status:"",role:"",page:1,size:10}),H=f("/api/upload/file"),z=f(),h=f(0),N=f(!1),M=f(0),s=B({catId:"",name:"",preset:"",des:"",coverImg:"",demoData:"",order:100,status:0}),J=B({catId:[{required:!0,message:"请选择App分类",trigger:"change"}],name:[{required:!0,message:"请填写App名称",trigger:"blur"}],preset:[{required:!0,message:"请填写App预设信息",trigger:"blur"}],des:[{required:!0,message:"请填写App描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!1,message:"请填写App演示数据",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择App状态",trigger:"change"}]}),F=f([]),q=f([]),X=Y(()=>h.value?"更新应用":"新增应用"),Z=Y(()=>h.value?"确认更新":"确认新增");async function g(){try{S.value=!0;const o=await k.queryApp(p),{rows:a,count:b}=o.data;S.value=!1,j.value=b,F.value=a.sort((V,y)=>y.order-V.order)}catch{S.value=!1}}async function ee(){const o=await k.queryCats({size:100}),{rows:a}=o.data;q.value=a}function le(o){h.value=o.id,N.value=o.role==="user",M.value=o.status;const{name:a,status:b,des:V,order:y,coverImg:C,catId:d,preset:w,demoData:c}=o;Ie(()=>{Object.assign(s,{name:a,status:b,des:V,order:y,coverImg:C,catId:d,preset:w,demoData:c})}),A.value=!0}function te(o){h.value=0,o==null||o.resetFields()}async function ae(o){await k.deleteApp({id:o.id}),I.success("删除分类成功"),g()}function oe(o){o==null||o.resetFields(),g()}const se=(o,a)=>{console.log("response: ",o.data),s.coverImg=o.data},re=o=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(o.type)){if(o.size/1024>300)return I.error("当前限制文件最大不超过 300KB!"),!1}else return I.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1};function ne(o){o==null||o.validate(async a=>{if(a){if(h.value){const b={id:h.value,...s};N.value&&Object.assign(b,{status:M.value}),await k.updateApp(b),I({type:"success",message:"更新应用成功！"})}else await k.createApp(s),I({type:"success",message:"创建新的应用成功！"});A.value=!1,g()}})}async function ue(o){const a=await k.auditPassApp({id:o.id});I({type:"success",message:a.data}),g()}async function de(o){const a=await k.auditFailApp({id:o.id});I({type:"success",message:a.data}),g()}return we(()=>{g(),ee()}),(o,a)=>{const b=r("el-alert"),V=be,y=r("el-option"),C=r("el-select"),d=r("el-form-item"),w=r("el-input"),c=r("el-button"),G=r("Plus"),Q=r("el-icon"),K=r("el-form"),pe=r("el-image"),m=r("el-table-column"),O=r("el-tag"),W=r("el-tooltip"),R=r("el-popconfirm"),ie=r("el-table"),ce=r("el-pagination"),me=r("el-row"),fe=r("el-switch"),_e=r("el-upload"),ge=r("el-dialog"),ve=he("loading");return n(),U("div",null,[l(V,null,{default:t(()=>[l(b,{closable:!1,"show-icon":"",title:"应用说明",description:"应用一旦创建、可能会被多处使用后续将限制删除、请保持良好习惯、规范命名分类、后续尽量变更而不是删除。用户创建的应用我们不允许删除、但是可以做一定的变更和修改、审核通过的应用也将限制用户更改、一旦通过或者拒绝、将不允许再次对其状态进行变更、开启GPT之外的大模型预设里务必插入用户提问内容固定关键字 SAI_USER_QUESTION_CONTENT 表示用户提问内容位置 请知悉！",type:"success"})]),_:1}),l(V,null,{default:t(()=>[l(K,{ref_key:"formRef",ref:L,inline:!0,model:p},{default:t(()=>[l(d,{label:"App分类",prop:"catId"},{default:t(()=>[l(C,{modelValue:p.catId,"onUpdate:modelValue":a[0]||(a[0]=e=>p.catId=e),placeholder:"请选择App分类",clearable:""},{default:t(()=>[(n(!0),U(P,null,D(u(q),e=>(n(),_(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"App状态",prop:"status"},{default:t(()=>[l(C,{modelValue:p.status,"onUpdate:modelValue":a[1]||(a[1]=e=>p.status=e),placeholder:"请选择App状态",clearable:""},{default:t(()=>[(n(!0),U(P,null,D(u(xe),e=>(n(),_(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"App名称",prop:"name"},{default:t(()=>[l(w,{modelValue:p.name,"onUpdate:modelValue":a[2]||(a[2]=e=>p.name=e),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:Ae(Ce(g,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),l(d,{label:"App角色",prop:"status"},{default:t(()=>[l(C,{modelValue:p.role,"onUpdate:modelValue":a[3]||(a[3]=e=>p.role=e),placeholder:"请选择App角色",clearable:""},{default:t(()=>[(n(!0),U(P,null,D(u(Te),e=>(n(),_(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(c,{type:"primary",onClick:g},{default:t(()=>[i(" 查询 ")]),_:1}),l(c,{onClick:a[4]||(a[4]=e=>oe(u(L)))},{default:t(()=>[i(" 重置 ")]),_:1})]),_:1}),l(c,{type:"success",style:{float:"right"},onClick:a[5]||(a[5]=e=>A.value=!0)},{default:t(()=>[i(" 创建应用 "),l(Q,{class:"ml-3"},{default:t(()=>[l(G)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{style:{width:"100%"}},{default:t(()=>[Ve((n(),_(ie,{border:"",data:u(F),style:{width:"100%"},size:"large"},{default:t(()=>[l(m,{prop:"coverImg",label:"应用封面",width:"100"},{default:t(e=>[l(pe,{style:{height:"50px"},src:e.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),l(m,{prop:"catName",label:"应用分类",width:"100"}),l(m,{prop:"name",label:"应用名称",width:"120"}),l(m,{prop:"status",label:"应用状态",width:"100"},{default:t(e=>[l(O,{type:e.row.status===1?"success":"danger"},{default:t(()=>[i(v(u(Se)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"public",label:"是否共享",width:"100"},{default:t(e=>[l(O,{type:e.row.public?"success":""},{default:t(()=>[i(v(e.row.public?"共享":"私有"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"public",label:"应用创建角色",width:"120"},{default:t(e=>[l(O,{type:e.row.role==="system"?"success":""},{default:t(()=>[i(v(e.row.role==="system"?"系统":"用户"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"order",label:"排序ID"}),i(" /> "),l(m,{prop:"preset",label:"预设信息",width:"400"},{default:t(e=>[l(W,{class:"box-item",effect:"dark",placement:"top-start"},{content:t(()=>[x("div",Pe,v(e.row.preset),1)]),default:t(()=>[x("div",De,v(e.row.preset),1)]),_:2},1024)]),_:1}),l(m,{prop:"des",label:"描述信息",width:"300"},{default:t(e=>[l(W,{class:"box-item",effect:"dark",placement:"top-start"},{content:t(()=>[x("div",ze,v(e.row.des),1)]),default:t(()=>[x("div",Ne,v(e.row.des),1)]),_:2},1024)]),_:1}),l(m,{prop:"createdAt",label:"创建时间",width:"120"},{default:t(e=>[i(v(u(Ue)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(m,{label:"操作",width:"200"},{default:t(e=>[e.row.role==="system"||e.row.public?(n(),_(c,{key:0,link:"",type:"primary",size:"small",onClick:$=>le(e.row)},{default:t(()=>[i(" 编辑 ")]),_:2},1032,["onClick"])):T("",!0),e.row.role==="system"?(n(),_(R,{key:1,title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:$=>ae(e.row)},{reference:t(()=>[l(c,{link:"",type:"danger",size:"small"},{default:t(()=>[i(" 删除应用 ")]),_:1})]),_:2},1032,["onConfirm"])):T("",!0),e.row.role==="user"&&e.row.status===3?(n(),_(R,{key:2,title:"确认通过审核此应用么?",width:"200","icon-color":"red",onConfirm:$=>ue(e.row)},{reference:t(()=>[l(c,{link:"",type:"success",size:"small"},{default:t(()=>[i(" 通过审核 ")]),_:1})]),_:2},1032,["onConfirm"])):T("",!0),e.row.role==="user"&&e.row.status===3?(n(),_(R,{key:3,title:"确认拒绝通过此应用共享请求么?",width:"200","icon-color":"red",onConfirm:$=>de(e.row)},{reference:t(()=>[l(c,{link:"",type:"danger",size:"small"},{default:t(()=>[i(" 拒绝审核 ")]),_:1})]),_:2},1032,["onConfirm"])):T("",!0)]),_:1})]),_:1},8,["data"])),[[ve,u(S)]]),l(me,{class:"flex justify-end mt-5"},{default:t(()=>[l(ce,{"current-page":p.page,"onUpdate:currentPage":a[6]||(a[6]=e=>p.page=e),"page-size":p.size,"onUpdate:pageSize":a[7]||(a[7]=e=>p.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:u(j),onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(ge,{modelValue:u(A),"onUpdate:modelValue":a[17]||(a[17]=e=>ke(A)?A.value=e:null),"close-on-click-modal":!1,title:u(X),width:"570",onClose:a[18]||(a[18]=e=>te(u(z)))},{footer:t(()=>[x("span",Oe,[l(c,{onClick:a[15]||(a[15]=e=>A.value=!1)},{default:t(()=>[i("取消")]),_:1}),l(c,{type:"primary",onClick:a[16]||(a[16]=e=>ne(u(z)))},{default:t(()=>[i(v(u(Z)),1)]),_:1})])]),default:t(()=>[l(K,{ref_key:"formPackageRef",ref:z,"label-position":"right","label-width":"100px",model:s,rules:J},{default:t(()=>[l(d,{label:"App分类",prop:"catId"},{default:t(()=>[l(C,{modelValue:s.catId,"onUpdate:modelValue":a[8]||(a[8]=e=>s.catId=e),placeholder:"请选择App分类",clearable:"",style:{width:"100%"}},{default:t(()=>[(n(!0),U(P,null,D(u(q),e=>(n(),_(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"App名称",prop:"name"},{default:t(()=>[l(w,{modelValue:s.name,"onUpdate:modelValue":a[9]||(a[9]=e=>s.name=e),placeholder:"请填写App名称"},null,8,["modelValue"])]),_:1}),u(N)?T("",!0):(n(),_(d,{key:0,label:"App状态",prop:"status"},{default:t(()=>[l(fe,{modelValue:s.status,"onUpdate:modelValue":a[10]||(a[10]=e=>s.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})),l(d,{label:"App预设",prop:"preset"},{default:t(()=>[l(w,{modelValue:s.preset,"onUpdate:modelValue":a[11]||(a[11]=e=>s.preset=e),type:"textarea",placeholder:"请填写App预设提示词、开启GPT之外的大模型需要插入 SAI_USER_QUESTION_CONTENT 表示用户提问内容",rows:4},null,8,["modelValue"])]),_:1}),l(d,{label:"App描述",prop:"des"},{default:t(()=>[l(w,{modelValue:s.des,"onUpdate:modelValue":a[12]||(a[12]=e=>s.des=e),type:"textarea",placeholder:"请填写App介绍信息",rows:4},null,8,["modelValue"])]),_:1}),l(d,{label:"示例内容",prop:"demoData"},{default:t(()=>[l(w,{modelValue:s.demoData,"onUpdate:modelValue":a[13]||(a[13]=e=>s.demoData=e),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4},null,8,["modelValue"])]),_:1}),l(d,{label:"应用Logo",prop:"coverImg"},{default:t(()=>[l(_e,{class:"avatar-uploader",action:u(H),"show-file-list":!1,"on-success":se,"before-upload":re},{default:t(()=>[s.coverImg?(n(),U("img",{key:0,src:s.coverImg,style:{width:"100px"},class:"avatar"},null,8,qe)):(n(),_(Q,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[l(G)]),_:1}))]),_:1},8,["action"])]),_:1}),l(d,{label:"排序ID",prop:"order"},{default:t(()=>[l(w,{modelValue:s.order,"onUpdate:modelValue":a[14]||(a[14]=e=>s.order=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof E=="function"&&E(Re);export{Re as default};
